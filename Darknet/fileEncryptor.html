<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>File Encryptor</title>
        <link rel="stylesheet" href="../style.css">
        <script defer src="sha512.js"></script>
        <script defer src="naÃ¯veCrypt.js"></script>
    </head>
    <body>
        <div id="title">
			<h1>File finder / decryptor / encryptor</h1>
		</div>

        <div id="mainOuter">

            <nav>
                <h2>Navigation</h2>
                <a href="../index.html">Main Page</a>
                <a href="index.html">Back to the Hub</a>
                <a href="../Font List/index.html">Font List</a>
                <a href="../System/index.html">TTRPG Wiki</a>
            </nav>

			<div id="mainInner">

                <div id="content">
                    <div class="box">
                        <h2>Overview</h2>
                        <p>
                            Since GitHub Pages (the service this website is hosted on) doesn't allow
                            code execution on the backend, it is impossible for me to ask visitors
                            who want to view a certain file for a password, then have the server check
                            their input and only disclose that file in case the password is correct.
                            I can also not rely on visitors having to know the path to the file they want to view
                            in order to access it, since they can simply look at the
                            <a href="https://github.com/molduin/molduin.github.io">GitHub project</a>
                            and browse the whole file structure there.
                            Then, how do I host files and prevent people I don't want to see the files from doing just that,
                            while keeping them accessible to those who know the corresponding password,
                            and all of that without setting up a home server?
                        </p>
                        <p>
                            The solution is not to host the files at all, but an encrypted version of them.
                            The password itself then acts as a decryption key
                            that is necessary to make sense of the data you can see.
                        </p>

                        <h2>Technical Details</h2>
                        <p>
                            The custom encryption algorithm uses SHA2-512
                            as a base to generate a symmetric key from the provided password.
                            It does so by hashing the password, thus generating a block of 512 bits,
                            that block being the first 512 bits of the key. If the plaintext is longer than 512 bits,
                            the next block is generated by concatenating the previous block with the password
                            and passing that concetenated data into the hash function.
                            That process is repeated until the generated key is at least as long as the plaintext.
                            The key is then truncated to exactly the length of the plaintext.
                            Finally, the key and the plaintext are bitwise XORed, producing the ciphertext.
                        </p>
                        <p>
                            As an additional security measure,
                            before being passed to the function generating the key,
                            the password is concatenated with a Uint8Array representation of the plaintext's length.
                            This is done to avoid using the same encryption key for two different files,
                            the old file and the new, edited file, which could reduce security.
                            This way, I can keep using the same password for a file after having edited it.
                        </p>
                        <p>
                            In the same vein, I could instead use a random salt which won't be encrypted,
                            which would cover the few cases in which the length of the file doesn't change after editing the plaintext.
                        </p>
                        <p class="infobox">
                            Yes, you <i>could</i> use this page as a personal file encryption and decryption tool,
                            but I advise against doing so, since I might make breaking changes
                            to the encryption algorithm.
                        </p>

                        <h2>Future Considerations</h2>
                        <ul>
                            <li>
                                As mentioned, I might include a random salt in encrypted files,
                                as well as (though I don't necessarily see a use for this just yet)
                                a utility to choose that salt manually while encrypting.
                            </li>
                            <li>
                                I might add the functionality of the Hub to the navigation bar on each page,
                                but that would require importing all of the file finding code to those pages.
                                However, the effect this would have on the site's performance is probably
                                laughably small.
                            </li>
                            <li>
                                Encrypting and decrypting large files currently seems to be quite slow,
                                taking a little more than one second per megabyte on my machine.
                                This might be due to the fact that the encryption algorithm is written in JavaScript.
                                However, performance is not a main concern since the algorithm is only run once per page visit,
                                not to mention that the size of the files decrypted will probably stay way under a megabyte.
                                If performance does become an issue, I could potentially try
                                re-writing the algorithm in another language using WebAssembly.
                            </li>
                        </ul>
                    </div>
                    <div class="box">
                        <h2>Tools</h2>
                        <p>
                            These tools are made to be used by myself to quickly encrypt files that I want to host here.
                            Try them out, if you want.
                            The one at the bottom is technically not necessary anymore
                            (the Hub exists, after all), but I'll keep it around.
                        </p>

                        <h2>Manual file encryption / decryption</h2>
                        <form>
                            <input id="fileInput" type="file" />
                            <br>
                            <label for="fileDomain">Domain (to people who are not me: You can leave this empty)</label>
                            <br>
                            <input type="password" id="fileDomain" style="min-width: 40%">
                            <input id="showDomainText" type="checkbox" onclick="
                                document.getElementById('fileDomain').type=this.checked?'text':'password'">
                            <label for="showDomainText">Show Text</label>
                            <br>
                            <label for="filePassword">Encryption/decryption password for file (UTF-8)...</label>
                            <br>
                            <input type="password" id="filePassword" style="min-width: 40%">
                            <input id="showText" type="checkbox" onclick="
                                document.getElementById('filePassword').type=this.checked?'text':'password'">
                            <label for="showText">Show Text</label>
                            <br>
                            <button id="download" type="submit" onclick="
                                encryptAndDownloadFile(
                                    document.getElementById('fileInput').files,
                                    domainConcat(document.getElementById('fileDomain').value, document.getElementById('filePassword').value),
                                    document.getElementById('useHash').checked
                                ); return false;">
                                Encrypt/decrypt and download file...
                            </button>
                            <br>
                            <input id="useHash" type="checkbox">
                            <label for="useHash">Rename file to confirmation hash</label>
                            <input id="cullHead" type="checkbox">
                            <label for="cullHead">Cull Head</label>
                        </form>

                        <h2>Find, decrypt and view existing file automatically</h2>
                        <form>
                            <input type="password" id="search">
                            <br>
                            <button id="open" type="submit" onclick=
                                "findAndLoad(document.getElementById('search').value, false); return false;">
                                Find and open with password
                            </button>
                        </form>
                    </div>

                </div>

                <aside>
                    <h3>Notes</h3>
                    <p>
                        Hey look, it's empty for once
                    </p>
                </aside>

            </div>

        </div>

    </body>
</html>